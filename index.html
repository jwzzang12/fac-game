<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Movie Quiz</title>
  </head>
  <body>
    <header><h1>Movie Quiz</h1></header>
    <div id="quiz">
      <div id="backdrop"><img src="" alt="" /></div>
      <div id="title" style="display: none"></div>
    </div>
    <div id="inputBox">
      <input type="text" id="inputWord" />
    </div>
    <div id="score"></div>
    <div id="timer"></div>
    <div id="restart"><button>Try again</button></div>
    <script>
      const options = {
        method: 'GET',
        headers: {
          accept: 'application/json',
          Authorization:
            'Bearer eyJhbGciOiJIUzI1NiJ9.eyJhdWQiOiJkN2Q2YjQzNmMyYWFmYmI5MDM0NTJkYjYyMjNkOWU2NiIsInN1YiI6IjYzMGQ2ZTllYmJjYWUwMDA3ZTQ5NmM5NiIsInNjb3BlcyI6WyJhcGlfcmVhZCJdLCJ2ZXJzaW9uIjoxfQ.ozHtkrnpGYvv65bpT_Om4cKN8H9NyxzOduQynHzk0xE',
        },
      };

      const quiz = document.querySelector('#quiz #backdrop img');
      const inputWord = document.querySelector('#inputWord');
      const score = document.querySelector('#score');
      const title = document.querySelector('#title');
      // const timer = document.querySelector('#timer');
      const restart = document.querySelector('#restart');

      let answer = '';
      let randomNum = 0;
      let count = 0;

      String.prototype.toWesternDigits = function () {
        return this.replace('III', '3').replace('II', '2');
      };

      const randomNumFunc = () => {
        randomNum = Math.floor(Math.random() * 19);
      };

      const keyupFunc = function (e) {
        if (e.keyCode === 13) {
          const typed = inputWord.value;
          if (answer[0].toLowerCase() == typed.toLowerCase()) {
            init();
            count++;
            score.textContent = count;
          } else {
            inputWord.disabled = true;
            title.style.display = 'block';
          }
        }
      };

      const init = function () {
        inputWord.addEventListener('keyup', keyupFunc);
        randomNumFunc();
        getMovieData();
        inputWord.value = '';
        inputWord.focus();
      };

      restart.addEventListener('click', init);
      //timer function
      //7 seconds, pass time -> lose

      async function getMovieData() {
        try {
          let obj;
          const res = await fetch(
            'https://api.themoviedb.org/4/account/630d6e9ebbcae0007e496c96/movie/recommendations?page=4&language=en-US',
            options
          );
          obj = await res.json();
          let movieData = obj.results;

          quiz.src = movieData.filter((el, idx) => idx === randomNum).map((el) => `https://image.tmdb.org/t/p/w780/${el.backdrop_path}`);

          answer = movieData.filter((el, idx) => idx === randomNum).map((el) => el.title.toWesternDigits());

          title.textContent = movieData.filter((el, idx) => idx === randomNum).map((el) => el.title);

          console.log(answer[0].toWesternDigits());
        } catch (err) {
          console.log(err);
        }
      }

      getMovieData();
      init();
    </script>
  </body>
</html>
