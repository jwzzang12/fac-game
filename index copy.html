<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="css/style.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200"
    />
    <title>Movie Quizüçø</title>
  </head>
  <body>
    <span class="material-symbols-outlined" id="info"> info </span>
    <div id="start" class="left">
      <div id="quizCountdown"></div>
      <div id="startBtn"><button>Start</button></div>
    </div>
    <div id="quiz" class="left">
      <div id="backdrop"><img src="" alt="" /></div>
      <div>?</div>
      <div id="titleBox">
        The answer is
        <div id="title"></div>
      </div>
    </div>
    <div id="answerBox" class="right">
      <div id="lose">LOSE!</div>
      <div id="inputBox">
        <input type="text" id="inputWord" />
      </div>
      <div id="timer"></div>
      <div id="scoreBox">
        <span>Your Score : </span>
        <span id="score">0</span>
      </div>
      <div id="restart"><button>Try again</button></div>
    </div>

    <script>
      const options = {
        method: 'GET',
        headers: {
          accept: 'application/json',
          Authorization:
            'Bearer eyJhbGciOiJIUzI1NiJ9.eyJhdWQiOiJkN2Q2YjQzNmMyYWFmYmI5MDM0NTJkYjYyMjNkOWU2NiIsInN1YiI6IjYzMGQ2ZTllYmJjYWUwMDA3ZTQ5NmM5NiIsInNjb3BlcyI6WyJhcGlfcmVhZCJdLCJ2ZXJzaW9uIjoxfQ.ozHtkrnpGYvv65bpT_Om4cKN8H9NyxzOduQynHzk0xE',
        },
      };

      const quiz = document.querySelector('#quiz #backdrop img');
      const lose = document.querySelector('#lose');

      const inputWord = document.querySelector('#inputWord');
      const score = document.querySelector('#score');
      const titleBox = document.querySelector('#titleBox');
      const title = document.querySelector('#title');
      // const timer = document.querySelector('#timer');
      const restart = document.querySelector('#restart');

      let answer = '';
      let randomNum = 0;
      let count = 0;

      String.prototype.toWesternDigits = function () {
        return this.replace('III', '3').replace('II', '2');
      };

      const randomNumFunc = () => {
        randomNum = Math.floor(Math.random() * 19);
      };

      const keyupFunc = (e) => {
        if (e.keyCode === 13) {
          const typed = inputWord.value;
          if (answer[0].toLowerCase() == typed.toLowerCase()) {
            init();
            count++;
            score.textContent = count;
          } else {
            inputWord.disabled = true;
            titleBox.style.display = 'block';
            lose.style.display = 'block';
            restart.style.display = 'block';
          }
        }
      };

      const init = () => {
        inputWord.addEventListener('keyup', keyupFunc);
        randomNumFunc();
        getMovieData();
        inputWord.value = '';
        inputWord.focus();
      };

      const reset = () => {
        init();
        count = 0;
        score.textContent = count;
        inputWord.disabled = false;
        titleBox.style.display = 'none';
        lose.style.display = 'none';
        restart.style.display = 'none';
      };
      restart.addEventListener('click', reset);
      //timer function
      //7 seconds, pass time -> lose

      async function getMovieData() {
        try {
          let obj;
          const res = await fetch(
            'https://api.themoviedb.org/4/account/630d6e9ebbcae0007e496c96/movie/recommendations?page=4&language=en-US',
            options
          );
          obj = await res.json();
          let movieData = obj.results;

          quiz.src = movieData.filter((el, idx) => idx === randomNum).map((el) => `https://image.tmdb.org/t/p/w780/${el.backdrop_path}`);

          answer = movieData.filter((el, idx) => idx === randomNum).map((el) => el.title.toWesternDigits());

          title.textContent = movieData.filter((el, idx) => idx === randomNum).map((el) => el.title);

          console.log(answer[0].toWesternDigits());
        } catch (err) {
          console.log(err);
        }
      }

      getMovieData();
      init();
    </script>
  </body>
</html>
